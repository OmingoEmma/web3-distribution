"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[121],{9376:function(t,e,r){var a=r(5475);r.o(a,"usePathname")&&r.d(e,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(e,{useRouter:function(){return a.useRouter}})},1519:function(t,e,r){r.d(e,{AuthProvider:function(){return c},a:function(){return l}});var a=r(7437),i=r(2265);let n=(0,i.createContext)(void 0),s={notifyResurfacingHours:6};function o(t){return"crt_settings_".concat(t)}let c=t=>{let{children:e}=t,[r,c]=(0,i.useState)(null),[l,u]=(0,i.useState)(s);(0,i.useEffect)(()=>{try{let t=localStorage.getItem("crt_user");if(t){let e=JSON.parse(t);c(e);let r=localStorage.getItem(o(e.id));r&&u({...s,...JSON.parse(r)})}}catch(t){}},[]),(0,i.useEffect)(()=>{try{r&&localStorage.setItem(o(r.id),JSON.stringify(l))}catch(t){}},[r,l]);let d=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"creator",a=JSON.parse(localStorage.getItem("crt_users")||"[]"),i=a.find(e=>e.email===t),n=i||{id:"user_".concat(Math.random().toString(36).slice(2,9)),name:e||t.split("@")[0],email:t,role:r};i||localStorage.setItem("crt_users",JSON.stringify([...a,n])),c(n),localStorage.setItem("crt_user",JSON.stringify(n));try{document.cookie="crt_user=".concat(encodeURIComponent(JSON.stringify(n)),"; path=/")}catch(t){}let l=localStorage.getItem(o(n.id));u(l?{...s,...JSON.parse(l)}:s)},h=(t,e,r)=>{let a={id:"user_".concat(Math.random().toString(36).slice(2,9)),name:t,email:e,role:r},i=JSON.parse(localStorage.getItem("crt_users")||"[]");localStorage.setItem("crt_users",JSON.stringify([...i,a])),localStorage.setItem("crt_user",JSON.stringify(a)),localStorage.setItem(o(a.id),JSON.stringify(s)),c(a),u(s);try{document.cookie="crt_user=".concat(encodeURIComponent(JSON.stringify(a)),"; path=/")}catch(t){}},E=(t,e,r)=>{let a={id:"user_".concat(Math.random().toString(36).slice(2,9)),name:t,email:e,role:r},i=JSON.parse(localStorage.getItem("crt_users")||"[]");localStorage.setItem("crt_users",JSON.stringify([...i,a]))},g=()=>{c(null),localStorage.removeItem("crt_user");try{document.cookie="crt_user=; Max-Age=0; path=/"}catch(t){}},N=t=>{u(e=>({...e,notifyResurfacingHours:t}))},m=()=>{try{return JSON.parse(localStorage.getItem("crt_users")||"[]")}catch(t){return[]}},f=(t,e)=>{try{let r=m().map(r=>r.id===t?{...r,role:e}:r);localStorage.setItem("crt_users",JSON.stringify(r));let a=JSON.parse(localStorage.getItem("crt_user")||"null");if(a&&a.id===t){let t={...a,role:e};localStorage.setItem("crt_user",JSON.stringify(t)),c(t)}}catch(t){}},T=(0,i.useMemo)(()=>({user:r,settings:l,login:d,signup:h,logout:g,setNotifyResurfacingHours:N,listUsers:m,setUserRole:f,inviteUser:E}),[r,l]);return(0,a.jsx)(n.Provider,{value:T,children:e})};function l(){let t=(0,i.useContext)(n);if(!t)throw Error("useAuth must be used within AuthProvider");return t}},4871:function(t,e,r){r.d(e,{b:function(){return n}});var a=r(288),i=r(919);class n{initializeProvider(){window.ethereum&&(this.provider=new a.Q(window.ethereum))}async getSigner(){this.provider||i.q.throwError(Error("Provider not initialized"),"getSigner");try{return this.signer=await this.provider.getSigner(),this.signer}catch(t){i.q.throwError(t,"Failed to get signer")}}async ensureConnection(){this.provider||this.initializeProvider(),this.provider||i.q.throwError(Error("WALLET_NOT_FOUND"),"Wallet connection required"),this.signer||await this.getSigner()}handleError(t,e){return i.q.handle(t,e)}async getNetwork(){return await this.ensureConnection(),await this.provider.getNetwork()}async getBlockNumber(){return await this.ensureConnection(),await this.provider.getBlockNumber()}constructor(){this.provider=null,this.signer=null,this.initializeProvider()}}},919:function(t,e,r){r.d(e,{q:function(){return a}});class a{static handle(t,e){let r=this.extractErrorCode(t),a=this.getUserFriendlyMessage(r,t),i=this.RETRYABLE_ERRORS.has(r),n={code:r,message:e?"".concat(e,": ").concat(a):a,originalError:t,isRetryable:i};return console.error("Service Error:",n),n}static extractErrorCode(t){var e;if(null==t?void 0:t.code){let e=t.code.toString().toUpperCase();if("ACTION_REJECTED"===e||"4001"===e)return"ACTION_REJECTED";if("INSUFFICIENT_FUNDS"===e)return"INSUFFICIENT_FUNDS";if("NETWORK_ERROR"===e)return"NETWORK_ERROR";if("CALL_EXCEPTION"===e)return"CALL_EXCEPTION";if("NONCE_EXPIRED"===e||"NONCE_TOO_LOW"===e)return"NONCE_TOO_LOW";if("REPLACEMENT_UNDERPRICED"===e)return"REPLACEMENT_UNDERPRICED"}if((null==t?void 0:t.code)===4001)return"USER_REJECTED";if((null==t?void 0:t.code)===-32002)return"WALLET_NOT_CONNECTED";if((null==t?void 0:t.code)===-32603)return"TRANSACTION_FAILED";let r=(null==t?void 0:null===(e=t.message)||void 0===e?void 0:e.toLowerCase())||"";return r.includes("user rejected")||r.includes("user denied")?"USER_REJECTED":r.includes("insufficient funds")?"INSUFFICIENT_FUNDS":r.includes("network")?"NETWORK_ERROR":r.includes("gas")?"GAS_ESTIMATION_FAILED":r.includes("revert")?"EXECUTION_REVERTED":r.includes("timeout")?"TIMEOUT":"UNKNOWN_ERROR"}static getUserFriendlyMessage(t,e){let r=this.ERROR_MESSAGES[t]||this.ERROR_MESSAGES.UNKNOWN_ERROR;return"EXECUTION_REVERTED"===t&&(null==e?void 0:e.reason)?"".concat(r,": ").concat(e.reason):"INSUFFICIENT_FUNDS"===t&&(null==e?void 0:e.shortfall)?"".concat(r,". Need ").concat(e.shortfall," more"):r}static isRetryable(t){return t.isRetryable}static throwError(t,e){throw this.handle(t,e)}}a.ERROR_MESSAGES={ACTION_REJECTED:"You cancelled the transaction",USER_REJECTED:"You cancelled the transaction",NETWORK_ERROR:"Network connection issue. Please check your internet",UNSUPPORTED_NETWORK:"Please switch to a supported network",NETWORK_CHANGED:"Network changed. Please refresh the page",WALLET_NOT_FOUND:"No wallet detected. Please install MetaMask",WALLET_NOT_CONNECTED:"Please connect your wallet first",INSUFFICIENT_FUNDS:"Insufficient funds for this transaction",TRANSACTION_FAILED:"Transaction failed. Please try again",GAS_ESTIMATION_FAILED:"Unable to estimate gas. Transaction may fail",NONCE_TOO_LOW:"Transaction nonce error. Please try again",REPLACEMENT_UNDERPRICED:"Gas price too low. Increase gas price",CONTRACT_NOT_FOUND:"Smart contract not found at this address",CALL_EXCEPTION:"Contract call failed. Check parameters",EXECUTION_REVERTED:"Transaction reverted. Check contract conditions",UNKNOWN_ERROR:"An unexpected error occurred",TIMEOUT:"Request timed out. Please try again"},a.RETRYABLE_ERRORS=new Set(["NETWORK_ERROR","TIMEOUT","NONCE_TOO_LOW","REPLACEMENT_UNDERPRICED"])},8309:function(t,e,r){r.d(e,{t:function(){return o}});var a=r(1662),i=r(3876),n=r(4871),s=r(9388);class o extends n.b{static getInstance(){return o.instance||(o.instance=new o),o.instance}async sendPayment(t){try{await this.ensureConnection();let e=await this.getSigner(),r=a.fi(t.amount),i=await e.sendTransaction({to:t.to,value:r}),n=t.memo?"Payment: ".concat(t.memo):"Payment of ".concat(t.amount," ").concat(t.currency||"ETH");return await this.transactionService.trackTransaction(i.hash,n)}catch(t){throw this.handleError(t,"Failed to send payment")}}async sendBatchPayments(t){try{await this.ensureConnection();let e=[];for(let r of t.payments)try{let t=await this.sendPayment(r);e.push(t)}catch(t){throw console.error("Failed to send payment to ".concat(r.to,":"),t),t}return e}catch(t){throw this.handleError(t,"Failed to send batch payments")}}async estimateGas(t){try{await this.ensureConnection();let e=await this.getSigner(),r=a.fi(t.amount),i=await this.provider.estimateGas({to:t.to,value:r,from:await e.getAddress()}),n=await this.provider.getFeeData(),s=n.gasPrice||a.vz("20","gwei");return{gasLimit:i.toString(),gasPrice:a.bM(s,"gwei"),maxFeePerGas:n.maxFeePerGas?a.bM(n.maxFeePerGas,"gwei"):void 0,maxPriorityFeePerGas:n.maxPriorityFeePerGas?a.bM(n.maxPriorityFeePerGas,"gwei"):void 0,estimatedCost:a.dF(i*s)}}catch(t){throw this.handleError(t,"Failed to estimate gas")}}async estimateBatchGas(t){try{await this.ensureConnection();let e=BigInt(0),r=await this.provider.getFeeData(),i=r.gasPrice||a.vz("20","gwei");for(let r of t.payments){let t=await this.estimateGas(r);e+=BigInt(t.gasLimit)}let n=e*i;return{gasLimit:e.toString(),gasPrice:a.bM(i,"gwei"),maxFeePerGas:r.maxFeePerGas?a.bM(r.maxFeePerGas,"gwei"):void 0,maxPriorityFeePerGas:r.maxPriorityFeePerGas?a.bM(r.maxPriorityFeePerGas,"gwei"):void 0,estimatedCost:a.dF(n)}}catch(t){throw this.handleError(t,"Failed to estimate batch gas")}}async getBalance(t){try{await this.ensureConnection();let e=t;if(!e){let t=await this.getSigner();e=await t.getAddress()}let r=await this.provider.getBalance(e);return a.dF(r)}catch(t){throw this.handleError(t,"Failed to get balance")}}async validatePayment(t){try{if(!i.UJ(t.to))return{valid:!1,error:"Invalid recipient address"};let e=parseFloat(t.amount);if(isNaN(e)||e<=0)return{valid:!1,error:"Invalid amount"};let r=await this.getBalance(),a=parseFloat(r);if(a<e)return{valid:!1,error:"Insufficient balance"};let n=await this.estimateGas(t),s=e+parseFloat(n.estimatedCost);if(a<s)return{valid:!1,error:"Insufficient balance for gas fees"};return{valid:!0}}catch(t){return{valid:!1,error:"Validation failed"}}}async validateBatchPayment(t){try{let e=0;for(let r of t.payments){if(!i.UJ(r.to))return{valid:!1,error:"Invalid address: ".concat(r.to)};let t=parseFloat(r.amount);if(isNaN(t)||t<=0)return{valid:!1,error:"Invalid amount for ".concat(r.to)};e+=t}let r=await this.getBalance(),a=parseFloat(r);if(a<e)return{valid:!1,error:"Insufficient balance for all payments"};let n=await this.estimateBatchGas(t),s=e+parseFloat(n.estimatedCost);if(a<s)return{valid:!1,error:"Insufficient balance for gas fees"};return{valid:!0}}catch(t){return{valid:!1,error:"Validation failed"}}}constructor(){super(),this.transactionService=s.p.getInstance()}}},9388:function(t,e,r){r.d(e,{p:function(){return c}});var a,i,n=r(1662),s=r(4871);(a=i||(i={})).PENDING="pending",a.CONFIRMED="confirmed",a.FAILED="failed";var o=r(919);class c extends s.b{static getInstance(){return c.instance||(c.instance=new c),c.instance}async trackTransaction(t,e){try{await this.ensureConnection();let a=await this.provider.getTransaction(t);a||o.q.throwError(Error("Transaction not found"),"trackTransaction");let s={hash:t,from:a.from,to:a.to||"",value:n.dF(a.value),status:i.PENDING,timestamp:Date.now(),description:e};this.saveTransaction(s);let c=await a.wait();if(c){var r;s.status=1===c.status?i.CONFIRMED:i.FAILED,s.blockNumber=c.blockNumber,s.gasUsed=c.gasUsed.toString(),s.effectiveGasPrice=null===(r=c.gasPrice)||void 0===r?void 0:r.toString(),this.updateTransaction(s)}return this.mapToReceipt(s)}catch(t){throw this.handleError(t,"Failed to track transaction")}}async getTransactionStatus(t){try{await this.ensureConnection();let e=await this.provider.getTransactionReceipt(t);if(!e)return i.PENDING;return 1===e.status?i.CONFIRMED:i.FAILED}catch(t){throw this.handleError(t,"Failed to get transaction status")}}async waitForTransaction(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{var r;await this.ensureConnection();let a=await this.provider.waitForTransaction(t,e);a||o.q.throwError(Error("Transaction receipt not found"),"waitForTransaction");let n={hash:t,from:a.from,to:a.to||"",value:"0",status:1===a.status?i.CONFIRMED:i.FAILED,timestamp:Date.now(),blockNumber:a.blockNumber,gasUsed:a.gasUsed.toString(),effectiveGasPrice:null===(r=a.gasPrice)||void 0===r?void 0:r.toString()};return this.updateTransaction(n),this.mapToReceipt(n)}catch(t){throw this.handleError(t,"Failed to wait for transaction")}}getRecentTransactions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;try{return this.getStoredTransactions().slice(0,t).map(t=>this.mapToReceipt(t))}catch(t){return console.error("Failed to get recent transactions:",t),[]}}getPendingTransactions(){try{return this.getStoredTransactions().filter(t=>t.status===i.PENDING).map(t=>this.mapToReceipt(t))}catch(t){return console.error("Failed to get pending transactions:",t),[]}}clearTransactionHistory(){localStorage.removeItem(c.STORAGE_KEY)}saveTransaction(t){let e=this.getStoredTransactions().filter(e=>e.hash!==t.hash),r=[t,...e].slice(0,c.MAX_STORED_TXS);localStorage.setItem(c.STORAGE_KEY,JSON.stringify(r))}updateTransaction(t){let e=this.getStoredTransactions(),r=e.findIndex(e=>e.hash===t.hash);-1!==r?(e[r]=t,localStorage.setItem(c.STORAGE_KEY,JSON.stringify(e))):this.saveTransaction(t)}getStoredTransactions(){try{let t=localStorage.getItem(c.STORAGE_KEY);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to parse stored transactions:",t),[]}}mapToReceipt(t){return{hash:t.hash,from:t.from,to:t.to,value:t.value,blockNumber:t.blockNumber||0,status:t.status,timestamp:t.timestamp,gasUsed:t.gasUsed||"0",effectiveGasPrice:t.effectiveGasPrice||"0"}}async refreshPendingTransactions(){for(let t of this.getPendingTransactions())try{await this.getTransactionStatus(t.hash)!==i.PENDING&&await this.waitForTransaction(t.hash)}catch(e){console.error("Failed to refresh transaction ".concat(t.hash,":"),e)}}constructor(){super()}}c.STORAGE_KEY="web3_transactions",c.MAX_STORED_TXS=50}}]);