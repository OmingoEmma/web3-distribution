(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[427],{6236:function(t,e,r){Promise.resolve().then(r.bind(r,2219))},2219:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return p}});var a=r(7437),s=r(2265),n=r(9376),o=r(1519),i=r(1987),c=r(4871),l=r(5810),d=r(1662),u=r(919),h=r(9388);class m extends c.b{static getInstance(){return m.instance||(m.instance=new m),m.instance}async loadContract(t,e){try{await this.ensureConnection();let r="".concat(t.toLowerCase());if(this.contracts.has(r))return this.contracts.get(r);let a=await this.getSigner(),s=new l.CH(t,e,a);return this.contracts.set(r,s),s}catch(t){throw this.handleError(t,"Failed to load contract")}}async callContractFunction(t,e){try{let r=(await this.loadContract(t.contractAddress,e)).getFunction(t.functionName);return r||u.q.throwError(Error("Function ".concat(t.functionName," not found")),"callContractFunction"),await r(...t.args)}catch(e){throw this.handleError(e,"Failed to call ".concat(t.functionName))}}async executeContractFunction(t,e){try{let r=(await this.loadContract(t.contractAddress,e)).getFunction(t.functionName);r||u.q.throwError(Error("Function ".concat(t.functionName," not found")),"executeContractFunction");let a={};t.value&&(a.value=d.fi(t.value));let s=await r(...t.args,a),n="Contract: ".concat(t.functionName);return await this.transactionService.trackTransaction(s.hash,n)}catch(e){throw this.handleError(e,"Failed to execute ".concat(t.functionName))}}async distributeRevenue(t,e,r,a){try{return await this.executeContractFunction({contractAddress:t,functionName:"distributeRevenue",args:[r],value:a},e)}catch(t){throw this.handleError(t,"Failed to distribute revenue")}}async getProjectDetails(t,e,r){try{let a=await this.callContractFunction({contractAddress:t,functionName:"getProject",args:[r]},e);return{projectId:r,name:a.name||"",totalRevenue:d.dF(a.totalRevenue||0),contributors:a.contributors||[],shares:a.shares||[],isActive:a.isActive||!1}}catch(t){throw this.handleError(t,"Failed to get project details")}}async getContributorShare(t,e,r,a){try{return(await this.callContractFunction({contractAddress:t,functionName:"getContributorShare",args:[r,a]},e)).toString()}catch(t){throw this.handleError(t,"Failed to get contributor share")}}async registerProject(t,e,r,a,s){try{a.length!==s.length&&u.q.throwError(Error("Contributors and shares length mismatch"),"registerProject");let n=s.reduce((t,e)=>t+e,0);return 100!==n&&u.q.throwError(Error("Shares must total 100%"),"registerProject"),await this.executeContractFunction({contractAddress:t,functionName:"registerProject",args:[r,a,s]},e)}catch(t){throw this.handleError(t,"Failed to register project")}}async estimateGas(t,e){try{let r=(await this.loadContract(t.contractAddress,e)).getFunction(t.functionName);r||u.q.throwError(Error("Function ".concat(t.functionName," not found")),"estimateGas");let a={};return t.value&&(a.value=d.fi(t.value)),(await r.estimateGas(...t.args,a)).toString()}catch(t){throw this.handleError(t,"Failed to estimate gas")}}clearCache(){this.contracts.clear()}async isContractDeployed(t){try{await this.ensureConnection();let e=await this.provider.getCode(t);return"0x"!==e}catch(t){return console.error("Failed to check contract deployment:",t),!1}}constructor(){super(),this.contracts=new Map,this.transactionService=h.p.getInstance()}}var g=r(8309);class x extends c.b{static getInstance(){return x.instance||(x.instance=new x),x.instance}setMode(t){this.currentMode=t,localStorage.setItem("distribution_mode",t)}getMode(){return this.currentMode}async distributeRevenue(t){let e=t.mode||this.currentMode;try{switch(e){case"mock":return await this.distributeMock(t);case"testnet":return await this.distributeTestnet(t);case"production":return await this.distributeProduction(t);default:throw Error("Unknown distribution mode: ".concat(e))}}catch(t){throw this.handleError(t,"Failed to distribute revenue")}}async distributeMock(t){console.log("Mock distribution:",t);let e=[];for(let r of t.shares){let t={hash:"0x".concat(Math.random().toString(16).slice(2,66)),from:"0x0000000000000000000000000000000000000000",to:r.walletAddress,value:r.amount.toString(),blockNumber:Math.floor(1e6*Math.random()),status:"confirmed",timestamp:Date.now(),gasUsed:"21000",effectiveGasPrice:"20000000000"};e.push(t)}let r={success:!0,mode:"mock",totalAmount:t.totalAmount,distributedAmount:t.shares.reduce((t,e)=>t+e.amount,0),transactions:e,errors:[],timestamp:Date.now()};return this.saveDistributionHistory(t,r),r}async distributeTestnet(t){console.log("Testnet distribution:",t);let e=[],r=[];if(t.useSmartContract&&t.contractAddress)try{let r=await this.distributeViaContract(t);e.push(r)}catch(t){r.push("Contract distribution failed: ".concat(t.message))}else for(let a of t.shares)try{let r=await this.paymentService.sendPayment({to:a.walletAddress,amount:a.amount.toString(),memo:"Revenue share for ".concat(t.projectName)});e.push(r)}catch(t){r.push("Payment to ".concat(a.contributorName," failed: ").concat(t.message))}let a=e.reduce((t,e)=>t+parseFloat(e.value),0),s={success:0===r.length,mode:"testnet",totalAmount:t.totalAmount,distributedAmount:a,transactions:e,errors:r,timestamp:Date.now()};return this.saveDistributionHistory(t,s),s}async distributeProduction(t){console.log("Production distribution:",t);let e=[],r=[];if(t.useSmartContract&&t.contractAddress)try{let r=await this.distributeViaContract(t);e.push(r)}catch(t){r.push("Contract distribution failed: ".concat(t.message))}else for(let a of t.shares)try{let r=await this.paymentService.sendPayment({to:a.walletAddress,amount:a.amount.toString(),memo:"Revenue share for ".concat(t.projectName)});e.push(r)}catch(t){r.push("Payment to ".concat(a.contributorName," failed: ").concat(t.message))}let a=e.reduce((t,e)=>t+parseFloat(e.value),0),s={success:0===r.length,mode:"production",totalAmount:t.totalAmount,distributedAmount:a,transactions:e,errors:r,timestamp:Date.now()};return this.saveDistributionHistory(t,s),s}async distributeViaContract(t){if(!t.contractAddress)throw Error("Contract address is required for smart contract distribution");return t.shares.map(t=>t.walletAddress),t.shares.map(t=>t.amount),{hash:"0x".concat(Math.random().toString(16).slice(2,66)),from:"0x0000000000000000000000000000000000000000",to:t.contractAddress,value:t.totalAmount.toString(),blockNumber:Math.floor(1e6*Math.random()),status:"confirmed",timestamp:Date.now(),gasUsed:"150000",effectiveGasPrice:"20000000000"}}async distributeFiatRevenue(t){console.log("Fiat distribution:",t);let e=[];for(let r of t.shares){let t={hash:"fiat_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,9)),from:"platform_treasury",to:r.contributorId,value:r.amount.toString(),blockNumber:0,status:"confirmed",timestamp:Date.now(),gasUsed:"0",effectiveGasPrice:"0"};e.push(t)}let r={success:!0,mode:this.currentMode,totalAmount:t.totalAmount,distributedAmount:t.shares.reduce((t,e)=>t+e.amount,0),transactions:e,errors:[],timestamp:Date.now()};return this.saveDistributionHistory(t,r),r}getDistributionHistory(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;try{let e=localStorage.getItem("distribution_history");return(e?JSON.parse(e):[]).slice(0,t)}catch(t){return console.error("Failed to get distribution history:",t),[]}}saveDistributionHistory(t,e){try{let t=localStorage.getItem("distribution_history"),r=t?JSON.parse(t):[];r.unshift(e),localStorage.setItem("distribution_history",JSON.stringify(r.slice(0,100)))}catch(t){console.error("Failed to save distribution history:",t)}}calculateShares(t,e){return e.map(e=>({contributorId:e.id,contributorName:e.name,walletAddress:e.walletAddress,percentage:e.percentage,amount:t*e.percentage/100}))}constructor(){super(),this.currentMode="mock",this.contractService=m.getInstance(),this.paymentService=g.t.getInstance(),this.transactionService=h.p.getInstance();{let t=localStorage.getItem("distribution_mode");t&&(this.currentMode=t)}}}var b=r(9064);function p(){let{user:t}=(0,o.a)(),e=(0,n.useRouter)(),[r,c]=(0,s.useState)("mock"),[l,d]=(0,s.useState)({totalProjects:0,totalRevenue:0,totalUsers:0,pendingPayouts:0});if((0,s.useEffect)(()=>{if(!t){e.replace("/login");return}if("admin"!==t.role){e.replace("/unauthorized");return}c(x.getInstance().getMode()),Promise.all([fetch("/api/projects").then(t=>t.json()),fetch("/api/revenue").then(t=>t.json()),fetch("/api/users").then(t=>t.json())]).then(t=>{let[e,r,a]=t,s=r.reduce((t,e)=>t+e.amount,0),n=r.filter(t=>"Pending"===t.status).reduce((t,e)=>t+e.amount,0);d({totalProjects:e.length,totalRevenue:s,totalUsers:a.length,pendingPayouts:n})}).catch(console.error)},[t,e]),!t||"admin"!==t.role)return null;let u=t=>{x.getInstance().setMode(t),c(t),b.Am.success("Distribution mode set to ".concat(t))};return(0,a.jsx)(i.l,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Admin Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage the entire platform from here."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Projects"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:l.totalProjects})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\uD83C\uDFAC"})]})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Revenue"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:["$",l.totalRevenue.toLocaleString()]})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCB0"})]})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Users"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:l.totalUsers})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\uD83D\uDC65"})]})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Pending Payouts"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:["$",l.pendingPayouts.toLocaleString()]})]}),(0,a.jsx)("div",{className:"text-3xl",children:"⏳"})]})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Revenue Distribution Mode"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Control how revenue is distributed across the platform."}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,a.jsx)("input",{type:"radio",name:"mode",value:"mock",checked:"mock"===r,onChange:t=>u(t.target.value),className:"mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:"Mock Mode"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Simulate distributions without actual blockchain transactions. Perfect for testing and development."})]}),"mock"===r&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded",children:"Active"})]}),(0,a.jsxs)("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,a.jsx)("input",{type:"radio",name:"mode",value:"testnet",checked:"testnet"===r,onChange:t=>u(t.target.value),className:"mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:"Testnet Mode"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Use testnet networks (Mumbai, Goerli) for real blockchain transactions with test tokens."})]}),"testnet"===r&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded",children:"Active"})]}),(0,a.jsxs)("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,a.jsx)("input",{type:"radio",name:"mode",value:"production",checked:"production"===r,onChange:t=>u(t.target.value),className:"mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:"Production Mode"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Use mainnet for real transactions with actual cryptocurrency. Use with caution."})]}),"production"===r&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded",children:"Active"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("button",{onClick:()=>e.push("/admin/users"),className:"p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:"Manage Users"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Invite users and manage roles"})]}),(0,a.jsxs)("button",{onClick:()=>e.push("/admin/projects"),className:"p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:"View Projects"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Monitor all projects"})]}),(0,a.jsxs)("button",{onClick:()=>e.push("/admin/revenue"),className:"p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:"Revenue Overview"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Track all revenue streams"})]})]})]})]})})}},1987:function(t,e,r){"use strict";r.d(e,{l:function(){return c}});var a=r(7437);r(2265);var s=r(7648),n=r(9376),o=r(1519);let i=t=>{let{href:e,label:r,icon:o}=t,i=(0,n.usePathname)(),c=i===e||i.startsWith(e+"/");return(0,a.jsxs)(s.default,{href:e,className:"flex items-center gap-3 px-4 py-3 rounded-lg text-sm transition-colors ".concat(c?"bg-blue-600 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800"),children:[(0,a.jsx)("span",{className:"text-lg",children:o}),(0,a.jsx)("span",{className:"font-medium",children:r})]})},c=t=>{let{children:e}=t,{user:r,logout:s}=(0,o.a)(),c=(0,n.useRouter)();return r&&"admin"===r.role?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,a.jsx)("nav",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Admin Dashboard"}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded",children:"Admin"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.email}),(0,a.jsx)("button",{onClick:()=>{s(),c.push("/login")},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Logout"})]})]})})}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-6",children:[(0,a.jsx)("aside",{className:"col-span-12 lg:col-span-3",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 space-y-2",children:[(0,a.jsx)("div",{className:"px-3 py-2 text-xs font-semibold tracking-wide text-gray-500 dark:text-gray-400 uppercase",children:"Navigation"}),(0,a.jsx)(i,{href:"/admin/dashboard",label:"Dashboard",icon:"\uD83D\uDCCA"}),(0,a.jsx)(i,{href:"/admin/projects",label:"Projects",icon:"\uD83C\uDFAC"}),(0,a.jsx)(i,{href:"/admin/revenue",label:"Revenue",icon:"\uD83D\uDCB0"}),(0,a.jsx)(i,{href:"/admin/rights",label:"Rights",icon:"⚖️"}),(0,a.jsx)(i,{href:"/admin/users",label:"Users",icon:"\uD83D\uDC65"}),(0,a.jsx)(i,{href:"/admin/contracts",label:"Contracts",icon:"\uD83D\uDCDD"}),(0,a.jsx)(i,{href:"/admin/settings",label:"Settings",icon:"⚙️"})]})}),(0,a.jsx)("main",{className:"col-span-12 lg:col-span-9",children:e})]})})]}):null}}},function(t){t.O(0,[648,64,138,121,971,117,744],function(){return t(t.s=6236)}),_N_E=t.O()}]);